<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üèØ ‰∫∫ÊïôÁâàÂàù‰∏ÄÂéÜÂè≤Ê†∏ÂøÉÁü•ËØÜÁÇπÈóØÂÖ≥</title>
    
    <!-- È¢òÁõÆÊï∞ÊçÆ -->
    <script src="‰∫∫Êïô_Âàù‰∏Ä_ÂéÜÂè≤_‰∏äÂÜå_È¢òÁõÆ.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 10px;
            color: #fff;
        }
        
        /* ËÉåÊôØÂè§È£éÁ∫πÁêÜ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 80%, rgba(255, 215, 0, 0.03) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(255, 0, 0, 0.03) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        .container { 
            max-width: 500px; 
            margin: 0 auto; 
            position: relative;
            z-index: 1;
        }
        
        .header { 
            text-align: center; 
            color: white; 
            padding: 15px 10px;
            background: linear-gradient(180deg, rgba(139, 0, 0, 0.3) 0%, transparent 100%);
            border-radius: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .header h1 { 
            font-size: 1.3rem; 
            margin-bottom: 8px; 
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            background: linear-gradient(90deg, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .progress-bar { 
            background: rgba(255,255,255,0.1); 
            border-radius: 20px; 
            height: 20px; 
            overflow: hidden; 
            margin: 10px 0;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .progress-fill { 
            background: linear-gradient(90deg, #ffd700, #ff6b6b, #8b0000);
            height: 100%; 
            border-radius: 20px; 
            transition: width 0.5s ease;
            position: relative;
        }
        
        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
        
        .stats { 
            display: flex; 
            justify-content: space-around; 
            color: white; 
            font-size: 0.8rem; 
            padding: 12px; 
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.2), rgba(255, 215, 0, 0.1)); 
            border-radius: 12px; 
            margin-bottom: 15px;
            border: 1px solid rgba(255, 215, 0, 0.2);
        }
        
        .stat-item { text-align: center; }
        .stat-value { 
            font-size: 1.2rem; 
            font-weight: bold; 
            background: linear-gradient(90deg, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .card-container { 
            perspective: 1000px; 
            margin-bottom: 15px;
        }
        
        .card {
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.95), rgba(22, 33, 62, 0.95));
            border-radius: 20px;
            padding: 25px 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4), 0 0 60px rgba(255, 215, 0, 0.1);
            min-height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            border: 2px solid rgba(255, 215, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 215, 0, 0.05) 0%, transparent 50%);
            animation: rotate 20s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .card > * {
            position: relative;
            z-index: 1;
        }
        
        .card-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding-bottom: 15px; 
            border-bottom: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .unit-tag { 
            background: linear-gradient(135deg, #8b0000, #dc143c); 
            color: white; 
            padding: 5px 14px; 
            border-radius: 20px; 
            font-size: 0.7rem; 
            font-weight: bold;
            box-shadow: 0 2px 10px rgba(139, 0, 0, 0.5);
        }
        
        .question-type { 
            background: rgba(255, 215, 0, 0.15); 
            color: #ffd700; 
            padding: 5px 12px; 
            border-radius: 15px; 
            font-size: 0.7rem;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        
        .question-content { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            padding: 20px 0;
        }
        
        .question-text { 
            font-size: 1.05rem; 
            color: #fff;
            line-height: 1.7;
            margin-bottom: 20px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        
        .options { 
            display: flex; 
            flex-direction: column; 
            gap: 12px;
        }
        
        .option {
            padding: 14px 18px; 
            border: 2px solid rgba(255, 215, 0, 0.3); 
            border-radius: 12px;
            cursor: pointer; 
            transition: all 0.3s ease; 
            font-size: 0.95rem; 
            text-align: left;
            background: rgba(255, 255, 255, 0.05);
            color: #e0e0e0;
            position: relative;
            overflow: hidden;
        }
        
        .option::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 215, 0, 0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .option:hover::before {
            left: 100%;
        }
        
        .option:hover { 
            border-color: #ffd700; 
            background: rgba(255, 215, 0, 0.1); 
            transform: translateX(5px);
        }
        
        .option.selected { 
            border-color: #ffd700; 
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.3), rgba(139, 0, 0, 0.3)); 
            color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .option.correct { 
            border-color: #4CAF50; 
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.4), rgba(0, 255, 0, 0.2)); 
            color: #4CAF50;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.4);
        }
        
        .option.wrong { 
            border-color: #f44336; 
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.4), rgba(255, 0, 0, 0.2)); 
            color: #f44336;
            box-shadow: 0 0 20px rgba(244, 67, 54, 0.4);
            animation: shake 0.5s ease-in-out;
        }
        
        .btn-container { 
            display: flex; 
            gap: 10px; 
            margin-top: 20px;
        }
        
        .btn {
            flex: 1; 
            padding: 16px 20px; 
            border: none; 
            border-radius: 12px;
            font-size: 1rem; 
            font-weight: bold; 
            cursor: pointer; 
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .btn-submit { 
            background: linear-gradient(135deg, #8b0000, #dc143c); 
            color: white;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.4);
        }
        
        .btn-submit:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 8px 25px rgba(139, 0, 0, 0.6);
        }
        
        .btn-submit:disabled { 
            opacity: 0.5; 
            cursor: not-allowed; 
            transform: none;
        }
        
        .btn-next { 
            background: linear-gradient(135deg, #ffd700, #ff6b6b); 
            color: #1a1a2e;
            display: none;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.4);
        }
        
        .btn-next:hover { 
            transform: translateY(-3px); 
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.6);
        }
        
        .feedback { 
            text-align: center; 
            padding: 15px; 
            border-radius: 12px; 
            margin-top: 15px; 
            font-weight: bold; 
            display: none;
            background: rgba(0, 0, 0, 0.3);
        }
        
        .feedback.correct { 
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.3), rgba(0, 255, 0, 0.1)); 
            color: #4CAF50; 
            display: block;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .feedback.wrong { 
            background: linear-gradient(135deg, rgba(244, 67, 54, 0.3), rgba(255, 0, 0, 0.1)); 
            color: #f44336; 
            display: block;
            border: 1px solid rgba(244, 67, 54, 0.3);
        }
        
        .empty-state { 
            text-align: center; 
            color: white; 
            padding: 50px 20px;
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.2), rgba(255, 215, 0, 0.1));
            border-radius: 20px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .empty-state h2 { 
            font-size: 1.5rem; 
            margin-bottom: 15px;
            background: linear-gradient(90deg, #ffd700, #ff6b6b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        /* ÈîôÈ¢òÊú¨ÊåâÈíÆ */
        .wrong-book-btn {
            background: linear-gradient(135deg, #ff6b6b, #dc143c);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(220, 20, 60, 0.4);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .wrong-book-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 20, 60, 0.6);
        }
        
        .wrong-book-btn.active {
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            color: #1a1a2e;
        }
        
        .wrong-count {
            background: rgba(255, 255, 255, 0.3);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
        }
        
        /* ÊéíË°åÊ¶úÊåâÈíÆ */
        .leaderboard-btn {
            background: linear-gradient(135deg, #ffd700, #ff6b6b);
            color: #1a1a2e;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(255, 215, 0, 0.4);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .leaderboard-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.6);
        }
        
        /* ÊåâÈíÆÂÆπÂô® */
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
        }
        
        .streak-indicator {
            position: fixed; 
            top: 10px; 
            right: 10px; 
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.95), rgba(255, 215, 0, 0.9));
            padding: 10px 20px; 
            border-radius: 25px; 
            font-size: 0.85rem; 
            font-weight: bold;
            color: white; 
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.5);
            display: none;
            border: 2px solid rgba(255, 215, 0, 0.5);
            z-index: 100;
        }
        
        .streak-indicator.show { 
            display: block; 
            animation: pulse 0.5s ease; 
        }
        
        @keyframes pulse { 
            0%, 100% { transform: scale(1); } 
            50% { transform: scale(1.1); } 
        }
        
        .reset-btn {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.3), rgba(255, 215, 0, 0.2)); 
            color: white; 
            border: 2px solid rgba(255, 215, 0, 0.3);
            padding: 10px 20px; 
            border-radius: 25px; 
            font-size: 0.9rem; 
            cursor: pointer; 
            margin-top: 15px;
            transition: all 0.3s ease;
        }
        
        .reset-btn:hover {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.5), rgba(255, 215, 0, 0.3));
            transform: translateY(-2px);
        }
        
        /* ÈÖ∑ÁÇ´ÁâπÊïà */
        .effect-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 60vh;
            pointer-events: none;
            z-index: 9999;
            overflow: hidden;
        }
        
        .effect-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 3rem;
            font-weight: bold;
            text-align: center;
            opacity: 0;
            z-index: 100;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 60px rgba(139, 0, 0, 0.6);
        }
        
        .effect-text.level-1 { color: #4CAF50; }
        .effect-text.level-2 { color: #FFD700; }
        .effect-text.level-3 { color: #FF6B6B; }
        .effect-text.level-4 { color: #FF1493; }
        .effect-text.level-5 { 
            color: #00FFFF; 
            text-shadow: 0 0 40px #00FFFF, 0 0 80px #FFD700, 0 0 120px #FF1493;
        }
        
        .effect-text.show {
            animation: textBurst 2s ease-out forwards;
        }
        
        @keyframes textBurst {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.3); }
            20% { opacity: 1; transform: translate(-50%, -50%) scale(1.3); }
            40% { transform: translate(-50%, -50%) scale(1); }
            80% { opacity: 1; }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8) translateY(-50px); }
        }
        
        /* Á≤íÂ≠êÊïàÊûú */
        .particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
        }
        
        .particle.star {
            width: 15px;
            height: 15px;
            background: radial-gradient(circle, #FFD700, #FFA500);
            box-shadow: 0 0 15px #FFD700;
            animation: twinkle 1s ease-in-out infinite;
        }
        
        .particle.heart {
            width: 20px;
            height: 20px;
            background: none;
        }
        
        .particle.heart::before,
        .particle.heart::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 32px;
            background: #FF6B6B;
            border-radius: 20px 20px 0 0;
        }
        
        .particle.heart::before {
            left: 0;
            transform: rotate(-45deg);
            transform-origin: 0 100%;
        }
        
        .particle.heart::after {
            left: 20px;
            transform: rotate(45deg);
            transform-origin: 100% 100%;
        }
        
        .particle.confetti {
            width: 10px;
            height: 10px;
            border-radius: 2px;
        }
        
        .particle.diamond {
            width: 15px;
            height: 15px;
            background: linear-gradient(135deg, #00FFFF, #FFFFFF, #00FFFF);
            transform: rotate(45deg);
            box-shadow: 0 0 15px #00FFFF;
        }
        
        .particle.flame {
            width: 12px;
            height: 20px;
            background: linear-gradient(to top, #8b0000, #ff6b6b, #ffd700);
            border-radius: 50% 50% 50% 50% / 60% 60% 40% 40%;
            box-shadow: 0 0 20px #ff6b6b, 0 0 40px #ffd700;
            animation: flame 0.8s ease-in-out infinite alternate;
        }
        
        @keyframes flame {
            0% { transform: translateY(0) scaleY(1); opacity: 0.9; }
            100% { transform: translateY(-10px) scaleY(1.1); opacity: 1; }
        }
        
        .particle.comet {
            width: 6px;
            height: 6px;
            background: #00FFFF;
            border-radius: 50%;
            box-shadow: 0 0 20px #00FFFF, 0 0 40px #FFD700;
            animation: comet 1.5s ease-in-out infinite;
        }
        
        .particle.comet::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 40px;
            height: 2px;
            background: linear-gradient(to left, transparent, #00FFFF, #FFD700);
        }
        
        @keyframes comet {
            0% { transform: translate(0, 0) rotate(45deg); }
            100% { transform: translate(-100px, 100px) rotate(45deg); }
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.5; transform: scale(0.8); }
            50% { opacity: 1; transform: scale(1.2); }
        }
        
        .firework {
            position: absolute;
            width: 5px;
            height: 5px;
            border-radius: 50%;
            animation: fireworkBurst 1.2s ease-out forwards;
        }
        
        @keyframes fireworkBurst {
            0% { opacity: 1; transform: translate(0, 0) scale(1); }
            100% { opacity: 0; transform: translate(var(--tx), var(--ty)) scale(0); }
        }
        
        .ring {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 60px;
            height: 60px;
            border: 4px solid;
            border-radius: 50%;
            transform: translate(-50%, -50%) scale(0);
            opacity: 0;
        }
        
        .ring.show {
            animation: ringExpand 1s ease-out forwards;
        }
        
        @keyframes ringExpand {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 1; }
            100% { transform: translate(-50%, -50%) scale(10); opacity: 0; }
        }
        
        .flash {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: white;
            opacity: 0;
            pointer-events: none;
            z-index: 9998;
        }
        
        .flash.show {
            animation: flashBurst 0.4s ease-out;
        }
        
        @keyframes flashBurst {
            0% { opacity: 0.7; }
            100% { opacity: 0; }
        }
        
        .falling-item {
            position: absolute;
            font-size: 2rem;
            animation: fallDown 2.5s ease-in forwards;
        }
        
        @keyframes fallDown {
            0% { transform: translateY(-50px) rotate(0deg); opacity: 1; }
            100% { transform: translateY(70vh) rotate(720deg); opacity: 0; }
        }
        
        .shake {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-8px); }
            20%, 40%, 60%, 80% { transform: translateX(8px); }
        }
        
        .combo-number {
            position: absolute;
            font-size: 5rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 30px #FF6B00, 4px 4px 0 #FF4500;
            animation: comboFloat 2s ease-out forwards;
        }
        
        @keyframes comboFloat {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            30% { opacity: 1; transform: translate(-50%, -50%) scale(1.4); }
            50% { transform: translate(-50%, -70%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -120%) scale(0.8); }
        }
        
        /* Ê®°ÊÄÅÊ°Ü */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(5px);
        }
        
        .modal-overlay.show {
            display: flex;
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 25px;
            padding: 35px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5), 0 0 60px rgba(255, 215, 0, 0.2);
            animation: modalSlideIn 0.4s ease-out;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-40px) scale(0.9); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }
        
        .modal-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 25px;
            text-align: center;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.5);
        }
        
        .username-input {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid rgba(255, 215, 0, 0.3);
            border-radius: 12px;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }
        
        .username-input:focus {
            outline: none;
            border-color: #ffd700;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .modal-btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .modal-btn-primary {
            background: linear-gradient(135deg, #8b0000, #dc143c);
            color: white;
            box-shadow: 0 4px 15px rgba(139, 0, 0, 0.4);
        }
        
        .modal-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(139, 0, 0, 0.6);
        }
        
        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: #999;
            transition: color 0.3s ease;
        }
        
        .modal-close:hover {
            color: #ffd700;
        }
        
        /* ÊéíË°åÊ¶úÊ†∑Âºè */
        .leaderboard-list {
            max-height: 60vh;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-radius: 15px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 215, 0, 0.1);
        }
        
        .leaderboard-item:hover {
            transform: translateX(5px);
            background: rgba(255, 215, 0, 0.1);
        }
        
        .leaderboard-rank {
            width: 45px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 1.3rem;
            font-weight: bold;
            border-radius: 50%;
            margin-right: 15px;
            background: rgba(255, 255, 255, 0.1);
            color: #999;
        }
        
        .leaderboard-item:nth-child(1) .leaderboard-rank {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            animation: goldPulse 2s ease-in-out infinite;
        }
        
        .leaderboard-item:nth-child(2) .leaderboard-rank {
            background: linear-gradient(135deg, #C0C0C0, #A0A0A0);
            color: white;
        }
        
        .leaderboard-item:nth-child(3) .leaderboard-rank {
            background: linear-gradient(135deg, #CD7F32, #A0522D);
            color: white;
        }
        
        @keyframes goldPulse {
            0%, 100% { transform: scale(1); box-shadow: 0 0 15px rgba(255, 215, 0, 0.5); }
            50% { transform: scale(1.15); box-shadow: 0 0 25px rgba(255, 215, 0, 0.8); }
        }
        
        .leaderboard-item:nth-child(1),
        .leaderboard-item:nth-child(2),
        .leaderboard-item:nth-child(3) {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 165, 0, 0.05));
            border: 2px solid rgba(255, 215, 0, 0.4);
        }
        
        .leaderboard-info {
            flex: 1;
        }
        
        .leaderboard-name {
            font-size: 1.05rem;
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }
        
        .leaderboard-score {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 2px 10px rgba(255, 215, 0, 0.5);
        }
        
        .leaderboard-item.current-user {
            background: linear-gradient(135deg, rgba(139, 0, 0, 0.3), rgba(255, 215, 0, 0.15));
            border: 2px solid #8b0000;
            box-shadow: 0 0 20px rgba(139, 0, 0, 0.3);
        }
        
        .leaderboard-item.current-user .leaderboard-name {
            color: #ffd700;
        }
        
        .leaderboard-medal {
            font-size: 1.8rem;
            margin-right: 10px;
        }
        
        /* Ëá™ÂÆö‰πâÊªöÂä®Êù° */
        .leaderboard-list::-webkit-scrollbar {
            width: 8px;
        }
        
        .leaderboard-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }
        
        .leaderboard-list::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #8b0000, #ffd700);
            border-radius: 4px;
        }
        
        /* ÈîôÈ¢òÊú¨Ê®°ÂºèÊåáÁ§∫Âô® */
        .mode-indicator {
            background: linear-gradient(135deg, #ff6b6b, #dc143c);
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            display: none;
            animation: pulse 2s ease-in-out infinite;
            box-shadow: 0 4px 15px rgba(220, 20, 60, 0.4);
        }
        
        .mode-indicator.show {
            display: block;
        }
        
        /* ÁßØÂàÜÂ¢ûÂä†Âä®Áîª */
        .score-float {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 2.5rem;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
            animation: scoreFloatUp 2s ease-out forwards;
            pointer-events: none;
            z-index: 9999;
        }
        
        @keyframes scoreFloatUp {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            30% { opacity: 1; transform: translate(-50%, -50%) scale(1.4); }
            50% { transform: translate(-50%, -70%) scale(1); }
            100% { opacity: 0; transform: translate(-50%, -120%) scale(0.8); }
        }
        
        @media (max-width: 380px) {
            .header h1 { font-size: 1.1rem; }
            .card { padding: 20px 15px; min-height: 280px; }
            .question-text { font-size: 0.95rem; }
            .option { padding: 12px 14px; font-size: 0.85rem; }
            .btn { padding: 14px 16px; font-size: 0.9rem; }
        }
    </style>
</head>
<body>
    <!-- ÁâπÊïàÂÆπÂô® -->
    <div class="effect-container" id="effectContainer"></div>
    <div class="flash" id="flashOverlay"></div>
    
    <div class="streak-indicator" id="streakIndicator">
        üî• ËøûÂØπ <span id="streakCount">0</span> Ê¨°
    </div>
    
    <div class="container">
        <div class="header">
            <h1>üèØ ‰∫∫ÊïôÁâàÂàù‰∏ÄÂéÜÂè≤Ê†∏ÂøÉÁü•ËØÜÁÇπ</h1>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%"></div>
            </div>
            <div class="stats">
                <div class="stat-item"><div class="stat-value" id="masteredCount">0</div><div>Â∑≤ÊéåÊè°</div></div>
                <div class="stat-item"><div class="stat-value" id="learningCount">300</div><div>Â≠¶‰π†‰∏≠</div></div>
                <div class="stat-item"><div class="stat-value" id="accuracyRate">0%</div><div>Ê≠£Á°ÆÁéá</div></div>
                <div class="stat-item"><div class="stat-value" id="totalScore">0</div><div>ÁßØÂàÜ</div></div>
            </div>
            <div class="button-group">
                <button class="wrong-book-btn" id="wrongBookBtn" onclick="toggleWrongBookMode()">
                    üìù ÈîôÈ¢òÊú¨ <span class="wrong-count" id="wrongCount">0</span>
                </button>
                <button class="leaderboard-btn" onclick="showLeaderboard()">
                    üèÜ ÊéíË°åÊ¶ú
                </button>
            </div>
        </div>
        
        <div class="mode-indicator" id="modeIndicator">
            üìù ÈîôÈ¢òËÆ≠ÁªÉÊ®°Âºè - ‰∏ìÈó®ÊîªÂÖãÈîôÈ¢òÔºÅ
        </div>
        
        <div id="gameArea">
            <div class="card-container">
                <div class="card" id="questionCard">
                    <div class="card-header">
                        <span class="unit-tag" id="unitTag">Á¨¨‰∏ÄÂçïÂÖÉ</span>
                        <span class="question-type" id="questionType">ÂéÜÂè≤Áü•ËØÜ</span>
                    </div>
                    <div class="question-content">
                        <div class="question-text" id="questionText">Âä†ËΩΩ‰∏≠...</div>
                        <div class="options" id="optionsContainer"></div>
                    </div>
                    <div class="feedback" id="feedback"></div>
                    <div class="btn-container">
                        <button class="btn btn-submit" id="submitBtn" disabled>Êèê‰∫§Á≠îÊ°à</button>
                        <button class="btn btn-next" id="nextBtn">‰∏ã‰∏ÄÈ¢ò</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="empty-state" id="emptyState" style="display: none;">
            <h2>üéâ ÊÅ≠ÂñúÂÆåÊàêÔºÅ</h2>
            <p>‰Ω†Â∑≤ÁªèÊéåÊè°‰∫ÜÊâÄÊúâÊ†∏ÂøÉÁü•ËØÜÁÇπÔºÅ</p>
            <button class="reset-btn" onclick="resetProgress()">ÈáçÊñ∞ÂºÄÂßã</button>
        </div>
    </div>
    
    <!-- Áî®Êà∑ÂêçËæìÂÖ•ÂºπÁ™ó -->
    <div class="modal-overlay" id="usernameModal">
        <div class="modal-content">
            <div class="modal-title">üëã Ê¨¢ËøéÊù•Âà∞‰ºèÁæ≤ÂéÜÂè≤ÈóØÂÖ≥ÔºÅ</div>
            <p style="color: #ccc; margin-bottom: 20px; text-align: center;">ËØ∑ËæìÂÖ•‰Ω†ÁöÑÊòµÁß∞ÂèÇ‰∏éÊéíË°åÊ¶ú</p>
            <input type="text" class="username-input" id="usernameInput" placeholder="ËØ∑ËæìÂÖ•‰Ω†ÁöÑÊòµÁß∞Ôºà2-10‰∏™Â≠óÁ¨¶Ôºâ" maxlength="10" onkeypress="if(event.key==='Enter')saveUsername()">
            <button class="modal-btn modal-btn-primary" onclick="saveUsername()">ÂºÄÂßãÈóØÂÖ≥</button>
        </div>
    </div>
    
    <!-- ÊéíË°åÊ¶úÂºπÁ™ó -->
    <div class="modal-overlay" id="leaderboardModal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close" onclick="closeLeaderboard()">&times;</button>
            <div class="modal-title" style="margin-bottom: 25px;">üèÜ ÁßØÂàÜÊéíË°åÊ¶ú</div>
            <div class="leaderboard-list" id="leaderboardList"></div>
        </div>
    </div>
    
    <script>
        // ========== Êï∞ÊçÆÂ≠òÂÇ®Â∏∏Èáè ==========
        const STORAGE_KEY = 'fuxi_history_progress';
        const WRONG_BOOK_KEY = 'fuxi_history_wrong_book';
        const USERNAME_KEY = 'fuxi_history_username';
        const SCORE_KEY = 'fuxi_history_score';
        const FIREBASE_CONFIG_KEY = 'fuxi_history_firebase_config';
        
        // ========== Firebase Ë∑ØÂæÑÔºàÁã¨Á´ã‰∫éËØ≠ÊñáÔºâ ==========
        const LEADERBOARD_PATH = 'leaderboard_users_lishi';
        
        // ========== Ê∏∏ÊàèÁä∂ÊÄÅ ==========
        let gameState = {
            currentQuestion: null,
            selectedOption: null,
            isWrongBookMode: false,
            wrongBook: [], // ÈîôÈ¢òÊú¨Ôºö[{questionId, wrongCount, lastWrongTime}]
            questionStates: {}, // ÊØèÈÅìÈ¢òÁöÑÂ≠¶‰π†Áä∂ÊÄÅÔºö{questionId: {frequency, consecutiveCorrect, wrongCount}}
            streak: 0,
            totalAttempts: 0,
            correctAttempts: 0,
            score: 0,
            username: null
        };
        
        // ========== ÈªòËÆ§ Firebase ÈÖçÁΩÆ ==========
        const defaultFirebaseConfig = {
            apiKey: "AIzaSyCh9Ar8TuQmZWtuOCTF6VzJNs_m0qbiHFk",
            authDomain: "fuxi-chu2-yuwen-up.firebaseapp.com",
            projectId: "fuxi-chu2-yuwen-up",
            storageBucket: "fuxi-chu2-yuwen-up.firebasestorage.app",
            messagingSenderId: "489932483223",
            appId: "1:489932483223:web:d3233921d00bdbb23b17d2",
            measurementId: "G-BPYRERB02C",
            databaseURL: "https://fuxi-chu2-yuwen-up-default-rtdb.asia-southeast1.firebasedatabase.app"
        };
        
        // ========== Firebase ÂàùÂßãÂåñ ==========
        let db = null;
        let firebaseInitialized = false;
        
        function initFirebase() {
            try {
                const savedConfig = localStorage.getItem(FIREBASE_CONFIG_KEY);
                const config = savedConfig ? JSON.parse(savedConfig) : defaultFirebaseConfig;
                
                firebase.initializeApp(config);
                db = firebase.database();
                firebaseInitialized = true;
                console.log('Firebase ÂàùÂßãÂåñÊàêÂäü');
            } catch (error) {
                console.error('Firebase ÂàùÂßãÂåñÂ§±Ë¥•:', error);
                firebaseInitialized = false;
            }
        }
        
        // ========== Êï∞ÊçÆÂä†ËΩΩ‰∏é‰øùÂ≠ò ==========
        function loadData() {
            const savedProgress = localStorage.getItem(STORAGE_KEY);
            if (savedProgress) {
                const parsed = JSON.parse(savedProgress);
                gameState.questionStates = parsed.questionStates || {};
                gameState.totalAttempts = parsed.totalAttempts || 0;
                gameState.correctAttempts = parsed.correctAttempts || 0;
                gameState.score = parsed.score || 0;
            }
            
            const savedWrongBook = localStorage.getItem(WRONG_BOOK_KEY);
            if (savedWrongBook) {
                gameState.wrongBook = JSON.parse(savedWrongBook);
            }
            
            const savedUsername = localStorage.getItem(USERNAME_KEY);
            if (savedUsername) {
                gameState.username = savedUsername;
            }
            
            initializeQuestionStates();
            updateStats();
        }
        
        function saveData() {
            const data = {
                questionStates: gameState.questionStates,
                totalAttempts: gameState.totalAttempts,
                correctAttempts: gameState.correctAttempts,
                score: gameState.score
            };
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            localStorage.setItem(WRONG_BOOK_KEY, JSON.stringify(gameState.wrongBook));
        }
        
        function initializeQuestionStates() {
            historyKnowledgePoints.forEach(q => {
                if (!gameState.questionStates[q.id]) {
                    gameState.questionStates[q.id] = {
                        frequency: 10,
                        consecutiveCorrect: 0,
                        wrongCount: 0
                    };
                }
            });
        }
        
        // ========== È¢òÁõÆÈÄâÊã© ==========
        function selectQuestion() {
            let availableQuestions = [];
            
            if (gameState.isWrongBookMode) {
                // ÈîôÈ¢òÊ®°ÂºèÔºö‰ºòÂÖàÈÄâÊã©ÈîôÈ¢ò
                const wrongQuestions = gameState.wrongBook.map(wb => {
                    const question = historyKnowledgePoints.find(q => q.id === wb.questionId);
                    return question ? { ...question, wrongCount: wb.wrongCount } : null;
                }).filter(q => q !== null);
                
                if (wrongQuestions.length > 0) {
                    // ÊåâÈîôËØØÊ¨°Êï∞ÊéíÂ∫èÔºåÈîôËØØÊ¨°Êï∞Â§öÁöÑ‰ºòÂÖàÂá∫Áé∞
                    availableQuestions = wrongQuestions.sort((a, b) => b.wrongCount - a.wrongCount);
                } else {
                    // ÈîôÈ¢òÊú¨‰∏∫Á©∫ÔºåÂàáÊç¢ÂõûÊôÆÈÄöÊ®°Âºè
                    toggleWrongBookMode();
                    return selectQuestion();
                }
            } else {
                // ÊôÆÈÄöÊ®°ÂºèÔºöËá™ÈÄÇÂ∫îÁÆóÊ≥ï
                availableQuestions = historyKnowledgePoints.filter(q => {
                    const state = gameState.questionStates[q.id];
                    return state.consecutiveCorrect < 3;
                });
                
                if (availableQuestions.length === 0) {
                    showEmptyState();
                    return;
                }
                
                // ÊåâÊùÉÈáçÈöèÊú∫ÈÄâÊã©
                availableQuestions.sort((a, b) => {
                    const stateA = gameState.questionStates[a.id];
                    const stateB = gameState.questionStates[b.id];
                    const weightA = stateA.frequency + (stateA.wrongCount * 5);
                    const weightB = stateB.frequency + (stateB.wrongCount * 5);
                    return Math.random() * (weightA + weightB) - weightA;
                });
            }
            
            gameState.currentQuestion = availableQuestions[0];
            gameState.selectedOption = null;
            renderQuestion();
        }
        
        // ========== È¢òÁõÆÊ∏≤Êüì ==========
        function renderQuestion() {
            const q = gameState.currentQuestion;
            document.getElementById('unitTag').textContent = q.unit;
            document.getElementById('questionType').textContent = q.type;
            document.getElementById('questionText').textContent = q.question;
            
            // Âä®ÊÄÅÈöèÊú∫ÂåñÈÄâÈ°πÈ°∫Â∫è
            const options = [...q.options];
            const correctAnswer = options[q.answer];
            
            // Fisher-Yates Ê¥óÁâåÁÆóÊ≥ï
            for (let i = options.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [options[i], options[j]] = [options[j], options[i]];
            }
            
            // ÊâæÂà∞Ê≠£Á°ÆÁ≠îÊ°àÁöÑÊñ∞‰ΩçÁΩÆ
            const newAnswerIndex = options.indexOf(correctAnswer);
            
            // ‰øùÂ≠òÊñ∞ÁöÑÁ≠îÊ°àÁ¥¢ÂºïÂà∞ÂΩìÂâçÈóÆÈ¢òÂØπË±°ÔºàÁî®‰∫éÂà§Êñ≠Ê≠£Á°ÆÊÄßÔºâ
            gameState.currentQuestion.currentAnswer = newAnswerIndex;
            
            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            options.forEach((option, index) => {
                const optionEl = document.createElement('div');
                optionEl.className = 'option';
                optionEl.textContent = option;
                optionEl.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionEl);
            });
            
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').style.display = 'block';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('feedback').style.display = 'none';
            document.getElementById('feedback').className = 'feedback';
            
            updateProgress();
        }
        
        function selectOption(index) {
            gameState.selectedOption = index;
            const options = document.querySelectorAll('.option');
            options.forEach((opt, i) => {
                opt.classList.remove('selected');
                if (i === index) {
                    opt.classList.add('selected');
                }
            });
            document.getElementById('submitBtn').disabled = false;
        }
        
        // ========== Á≠îÈ¢òÂ§ÑÁêÜ ==========
        function submitAnswer() {
            if (gameState.selectedOption === null) return;
            
            const q = gameState.currentQuestion;
            const isCorrect = gameState.selectedOption === q.currentAnswer;
            const state = gameState.questionStates[q.id];
            
            gameState.totalAttempts++;
            
            const options = document.querySelectorAll('.option');
            options.forEach((opt, i) => {
                opt.onclick = null;
                if (i === q.currentAnswer) {
                    opt.classList.add('correct');
                } else if (i === gameState.selectedOption && !isCorrect) {
                    opt.classList.add('wrong');
                }
            });
            
            const feedback = document.getElementById('feedback');
            feedback.style.display = 'block';
            
            if (isCorrect) {
                state.consecutiveCorrect++;
                state.frequency = Math.max(1, state.frequency - 2);
                gameState.correctAttempts++;
                gameState.streak++;
                
                // Â¶ÇÊûúËøôÈÅìÈ¢òÂú®ÈîôÈ¢òÊú¨‰∏≠ÔºåÂáèÂ∞ëÈîôËØØËÆ°Êï∞
                const wrongBookIndex = gameState.wrongBook.findIndex(wb => wb.questionId === q.id);
                if (wrongBookIndex !== -1) {
                    gameState.wrongBook[wrongBookIndex].wrongCount--;
                    if (gameState.wrongBook[wrongBookIndex].wrongCount <= 0) {
                        gameState.wrongBook.splice(wrongBookIndex, 1);
                    }
                }
                
                // ËÆ°ÁÆóÁßØÂàÜ
                let points = 0;
                if (state.consecutiveCorrect === 1) {
                    points = 1;
                } else if (state.consecutiveCorrect === 3 || state.consecutiveCorrect === 4) {
                    points = 3;
                } else if (state.consecutiveCorrect >= 5 && state.consecutiveCorrect <= 9) {
                    points = 5;
                } else if (state.consecutiveCorrect >= 10) {
                    points = 10;
                }
                
                // Â¶ÇÊûúËøûÁª≠Ê≠£Á°ÆËææÂà∞3Ê¨°ÔºåÈ¢ùÂ§ñÂ•ñÂä±50ÂàÜ
                if (state.consecutiveCorrect === 3) {
                    points += 50;
                    showEffect(5, '+50 Â∑≤ÊéåÊè°ÔºÅ');
                } else if (points > 0) {
                    showEffect(points === 1 ? 1 : points === 3 ? 2 : points === 5 ? 3 : 4, `+${points}`);
                }
                
                gameState.score += points;
                feedback.textContent = '‚úÖ ÂõûÁ≠îÊ≠£Á°ÆÔºÅ' + (state.consecutiveCorrect >= 3 ? ' Â∑≤ÊéåÊè°ÔºÅ' : '');
                feedback.className = 'feedback correct';
                
                // Êõ¥Êñ∞ Firebase ÁßØÂàÜ
                updateScoreInFirebase();
                
            } else {
                state.consecutiveCorrect = 0;
                state.frequency = 10;
                state.wrongCount++;
                gameState.streak = 0;
                
                // Âä†ÂÖ•ÈîôÈ¢òÊú¨
                const wrongBookEntry = gameState.wrongBook.find(wb => wb.questionId === q.id);
                if (wrongBookEntry) {
                    wrongBookEntry.wrongCount++;
                    wrongBookEntry.lastWrongTime = Date.now();
                } else {
                    gameState.wrongBook.push({
                        questionId: q.id,
                        wrongCount: 1,
                        lastWrongTime: Date.now()
                    });
                }
                
                feedback.textContent = `‚ùå ÂõûÁ≠îÈîôËØØÔºÅÊ≠£Á°ÆÁ≠îÊ°àÊòØÔºö${q.options[q.answer]}\n\nËß£ÊûêÔºö${q.explanation}`;
                feedback.className = 'feedback wrong';
                
                // ÈúáÂä®ÊïàÊûú
                document.getElementById('questionCard').classList.add('shake');
                setTimeout(() => {
                    document.getElementById('questionCard').classList.remove('shake');
                }, 500);
            }
            
            document.getElementById('submitBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'block';
            
            saveData();
            updateStats();
            updateStreakIndicator();
            updateWrongCount();
        }
        
        function nextQuestion() {
            selectQuestion();
        }
        
        // ========== ÈîôÈ¢òÊú¨ÂäüËÉΩ ==========
        function toggleWrongBookMode() {
            gameState.isWrongBookMode = !gameState.isWrongBookMode;
            
            const btn = document.getElementById('wrongBookBtn');
            const indicator = document.getElementById('modeIndicator');
            
            if (gameState.isWrongBookMode) {
                if (gameState.wrongBook.length === 0) {
                    alert('ÈîôÈ¢òÊú¨‰∏∫Á©∫ÔºåÁªßÁª≠ÂÅöÈ¢òÂêßÔºÅ');
                    gameState.isWrongBookMode = false;
                    return;
                }
                btn.classList.add('active');
                indicator.classList.add('show');
                indicator.textContent = `üìù ÈîôÈ¢òËÆ≠ÁªÉÊ®°Âºè - ${gameState.wrongBook.length} ÈÅìÈîôÈ¢òÂæÖÊîªÂÖãÔºÅ`;
            } else {
                btn.classList.remove('active');
                indicator.classList.remove('show');
            }
            
            selectQuestion();
        }
        
        function updateWrongCount() {
            document.getElementById('wrongCount').textContent = gameState.wrongBook.length;
        }
        
        // ========== UI Êõ¥Êñ∞ ==========
        function updateStats() {
            const mastered = Object.values(gameState.questionStates).filter(s => s.consecutiveCorrect >= 3).length;
            const learning = 300 - mastered;
            const accuracy = gameState.totalAttempts > 0 
                ? Math.round((gameState.correctAttempts / gameState.totalAttempts) * 100) 
                : 0;
            
            document.getElementById('masteredCount').textContent = mastered;
            document.getElementById('learningCount').textContent = learning;
            document.getElementById('accuracyRate').textContent = accuracy + '%';
            document.getElementById('totalScore').textContent = gameState.score;
            
            updateWrongCount();
        }
        
        function updateProgress() {
            const mastered = Object.values(gameState.questionStates).filter(s => s.consecutiveCorrect >= 3).length;
            const progress = (mastered / 300) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
        }
        
        function updateStreakIndicator() {
            const indicator = document.getElementById('streakIndicator');
            const count = document.getElementById('streakCount');
            
            if (gameState.streak >= 3) {
                indicator.classList.add('show');
                count.textContent = gameState.streak;
            } else {
                indicator.classList.remove('show');
            }
        }
        
        function showEmptyState() {
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('emptyState').style.display = 'block';
        }
        
        function resetProgress() {
            if (confirm('Á°ÆÂÆöË¶ÅÈáçÁΩÆÊâÄÊúâËøõÂ∫¶ÂêóÔºüËøôÂ∞ÜÊ∏ÖÈô§Â∑≤ÊéåÊè°ÁöÑÈ¢òÁõÆÂíåÈîôÈ¢òÊú¨„ÄÇ')) {
                localStorage.removeItem(STORAGE_KEY);
                localStorage.removeItem(WRONG_BOOK_KEY);
                location.reload();
            }
        }
        
        // ========== ÁâπÊïàÁ≥ªÁªü ==========
        function showEffect(level, text) {
            const container = document.getElementById('effectContainer');
            const flash = document.getElementById('flashOverlay');
            
            // Èó™ÂÖâÊïàÊûú
            flash.classList.add('show');
            setTimeout(() => flash.classList.remove('show'), 400);
            
            // ‰∏≠Â§ÆÊñáÂ≠ó
            const effectText = document.createElement('div');
            effectText.className = `effect-text level-${level}`;
            effectText.textContent = text;
            container.appendChild(effectText);
            
            setTimeout(() => {
                effectText.classList.add('show');
            }, 50);
            
            setTimeout(() => {
                effectText.remove();
            }, 2000);
            
            // Á≤íÂ≠êÊïàÊûú
            const particleCount = level >= 4 ? 30 : level >= 3 ? 20 : level >= 2 ? 15 : 10;
            
            for (let i = 0; i < particleCount; i++) {
                setTimeout(() => {
                    createParticle(container, level);
                }, i * 30);
            }
            
            // ËøûÂáªÊòæÁ§∫
            if (gameState.streak >= 5) {
                const comboEl = document.createElement('div');
                comboEl.className = 'combo-number';
                comboEl.textContent = `${gameState.streak} ËøûÂØπÔºÅ`;
                comboEl.style.left = '70%';
                comboEl.style.top = '30%';
                container.appendChild(comboEl);
                
                setTimeout(() => comboEl.remove(), 2000);
            }
        }
        
        function createParticle(container, level) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            
            const types = ['star', 'flame', 'diamond', 'comet'];
            const type = types[Math.floor(Math.random() * types.length)];
            particle.classList.add(type);
            
            const startX = Math.random() * window.innerWidth;
            const startY = Math.random() * window.innerHeight * 0.5;
            
            particle.style.left = startX + 'px';
            particle.style.top = startY + 'px';
            
            container.appendChild(particle);
            
            // ÈöèÊú∫ÁßªÂä®Âä®Áîª
            const endX = (Math.random() - 0.5) * 300;
            const endY = Math.random() * 200 + 100;
            const duration = Math.random() * 1000 + 1000;
            
            particle.animate([
                { transform: 'translate(0, 0) scale(1)', opacity: 1 },
                { transform: `translate(${endX}px, ${endY}px) scale(0)`, opacity: 0 }
            ], {
                duration: duration,
                easing: 'ease-out'
            });
            
            setTimeout(() => particle.remove(), duration);
        }
        
        // ========== Áî®Êà∑ÂêçÁÆ°ÁêÜ ==========
        function checkUsername() {
            if (!gameState.username) {
                document.getElementById('usernameModal').classList.add('show');
            }
        }
        
        function saveUsername() {
            const username = document.getElementById('usernameInput').value.trim();
            if (username.length < 2 || username.length > 10) {
                alert('ÊòµÁß∞ÈïøÂ∫¶Â∫îÂú®2-10‰∏™Â≠óÁ¨¶‰πãÈó¥');
                return;
            }
            
            gameState.username = username;
            localStorage.setItem(USERNAME_KEY, username);
            document.getElementById('usernameModal').classList.remove('show');
            updateScoreInFirebase();
        }
        
        // ========== Firebase ÁßØÂàÜÁ≥ªÁªü ==========
        function updateScoreInFirebase() {
            if (!firebaseInitialized || !db || !gameState.username) return;
            
            const userRef = db.ref(`${LEADERBOARD_PATH}/${encodeURIComponent(gameState.username)}`);
            userRef.set({
                username: gameState.username,
                score: gameState.score,
                updateTime: Date.now()
            });
        }
        
        function showLeaderboard() {
            if (!firebaseInitialized || !db) {
                alert('Firebase Êú™ÂàùÂßãÂåñÔºåÊó†Ê≥ïÊòæÁ§∫ÊéíË°åÊ¶ú');
                return;
            }
            
            document.getElementById('leaderboardModal').classList.add('show');
            loadLeaderboard();
        }
        
        function closeLeaderboard() {
            document.getElementById('leaderboardModal').classList.remove('show');
        }
        
        function loadLeaderboard() {
            if (!firebaseInitialized || !db) return;
            
            const leaderboardRef = db.ref(LEADERBOARD_PATH);
            leaderboardRef.on('value', (snapshot) => {
                const data = snapshot.val();
                const list = document.getElementById('leaderboardList');
                list.innerHTML = '';
                
                if (!data) {
                    list.innerHTML = '<p style="text-align: center; color: #999; padding: 20px;">ÊöÇÊó†ÊéíË°åÊ¶úÊï∞ÊçÆ</p>';
                    return;
                }
                
                const users = Object.values(data).sort((a, b) => b.score - a.score);
                
                users.forEach((user, index) => {
                    const item = document.createElement('div');
                    item.className = 'leaderboard-item';
                    if (user.username === gameState.username) {
                        item.classList.add('current-user');
                    }
                    
                    let medal = '';
                    if (index === 0) medal = 'ü•á';
                    else if (index === 1) medal = 'ü•à';
                    else if (index === 2) medal = 'ü•â';
                    
                    item.innerHTML = `
                        <div class="leaderboard-rank">${medal || index + 1}</div>
                        <div class="leaderboard-info">
                            <div class="leaderboard-name">${user.username}</div>
                            <div class="leaderboard-score">${user.score} ÂàÜ</div>
                        </div>
                    `;
                    
                    list.appendChild(item);
                });
            });
        }
        
        // ========== ÂàùÂßãÂåñ ==========
        document.addEventListener('DOMContentLoaded', () => {
            initFirebase();
            loadData();
            checkUsername();
            selectQuestion();
        });
        
        // ÁªëÂÆöÊåâÈíÆ‰∫ã‰ª∂
        document.getElementById('submitBtn').onclick = submitAnswer;
        document.getElementById('nextBtn').onclick = nextQuestion;
    </script>
</body>
</html>